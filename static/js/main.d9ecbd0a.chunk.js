(this.webpackJsonpgame=this.webpackJsonpgame||[]).push([[0],{44:function(e,t,n){},63:function(e,t,n){"use strict";n.r(t);var a=n(5),c=n.n(a),r=n(37),s=n.n(r),i=(n(44),n(7)),o=n(9),u=n(22),l=n(68),b=n(71),d=n(13),j=n(69),m=n(12);function f(){return Object(m.jsx)(j.a,{distance:3e3,turbidity:8,rayleigh:6,mieCoefficient:.005,mieDirectionalG:.8,inclination:.49,azimuth:.25})}var h=n(64),k=n(67);function O(){var e=Object(h.a)(["/assets/textures/ground-texture-skin.jpg","/assets/textures/ground-texture-color.jpg"]),t=Object(o.a)(e,2),n=t[0],a=t[1],c=Object(u.c)((function(){return{position:[0,-.01,0],rotation:[-Math.PI/2,0,0]}})),r=Object(o.a)(c,1)[0];return Object(m.jsx)(k.a,{resolution:512,ref:r,args:[100,100,4,4],mirror:.4,mixBlur:8,mixStrength:1,rotation:[-Math.PI/2,0,Math.PI/2],blur:[400,100],children:function(e,t){return Object(m.jsx)(e,Object(i.a)({color:"#797979",metalness:.4,roughnessMap:n,normalMap:a,normalScale:[1,1]},t))}})}var g=n(14),p=n(16),v=n(66),x=n(70),w=n(65),y=n(0),A=n(40),I=Math.PI/2-.1,P="/assets/models",S=n(35),C=n.n(S);function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onAttack,n=e.onMoveChanged,a=e.onSpeedChanged,c=function(e){switch(e.preventDefault(),e.key){case"w":case"a":case"s":case"d":null===n||void 0===n||n({type:"start",direction:{w:"forward",s:"backward",a:"left",d:"right"}[e.key]});break;case"Shift":null===a||void 0===a||a({type:"run",selected:!0})}},r=function(e){switch(e.preventDefault(),e.key){case"w":case"a":case"s":case"d":null===n||void 0===n||n({type:"end",direction:{w:"forward",s:"backward",a:"left",d:"right"}[e.key]});break;case"Shift":null===a||void 0===a||a({type:"run",selected:!1})}};function s(e){e.preventDefault(),t()}return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(C.a,{target:"window",onKeyDown:c,onKeyUp:r}),Object(m.jsx)(C.a,{target:document.querySelector(".main-canvas"),onClick:s})]})}var R=["idle","walk","run"],T=["small-slash","kick","spin-slash"];function z(e){Object.assign({},e);var t=Object(a.useRef)(),n=Object(a.useRef)({walkClock:new y.Clock,comboResetTimer:null,movements:[],isRunning:!1,attack:{combo:0,isAttackInProgress:!1}}),c=Object(a.useState)(),r=Object(o.a)(c,2),s=r[0],i=r[1],u=Object(v.a)("".concat(P,"/player.fbx")),l=function(e){var t=D("idle"),n=D("kick"),a=D("small-slash"),c=D("spin-slash"),r=D("walk"),s=D("run");return Object(w.a)([].concat(Object(g.a)(s.animations),Object(g.a)(t.animations),Object(g.a)(n.animations),Object(g.a)(a.animations),Object(g.a)(c.animations),Object(g.a)(r.animations)),e)}(u),b=l.actions,j=l.mixer;return Object(a.useEffect)((function(){u.scale.x>.02&&u.scale.multiplyScalar(.02),t.current.rotateSpeed=.3}),[]),Object(a.useEffect)((function(){var e=s||"idle",t=b[e];return"idle"===e||j.addEventListener("finished",(function(e){i(null)})),null===t||void 0===t||t.reset().fadeIn(R.includes(e)?.5:.1).setLoop(R.includes(e)?y.LoopRepeat:y.LoopOnce).setEffectiveTimeScale(R.includes(e)?1:1.2).play(),t.clampWhenFinished=!0,function(){null===t||void 0===t||t.fadeOut(.5)}}),[s,b,j]),Object(d.c)((function(){var e,a;t.current.target=u.position.clone().setY(2.5),n.current.movements.length?i(n.current.isRunning?"run":"walk"):n.current.movements.length||n.current.attack.isAttackInProgress||i(null);var c=new y.Vector3,r=Object(A.a)(0,n.current.isRunning?.15:.08,Math.min(n.current.walkClock.getElapsedTime(),1));if(!n.current.attack.isAttackInProgress){var o,l=Object(p.a)(n.current.movements);try{for(l.s();!(o=l.n()).done;){switch(o.value){case"backward":c.z+=r;break;case"forward":c.z+=-r;break;case"right":c.x+=.02;break;case"left":c.x+=-.02}}}catch(f){l.e(f)}finally{l.f()}}c.applyAxisAngle(new y.Vector3(0,1,0),t.current.getAzimuthalAngle()),u.rotation.y=t.current.getAzimuthalAngle()+Math.PI,u.position.add(c);var d=T.includes(s),j=null===(e=b[s])||void 0===e?void 0:e.time,m=null===(a=b[s])||void 0===a?void 0:a.getClip().duration;(d&&j>m-.02*m||!d)&&(n.current.attack.isAttackInProgress=!1)})),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("primitive",{object:u,dispose:null}),Object(m.jsx)(x.a,{ref:t,maxPolarAngle:I,maxDistance:5,enableDamping:!1,enablePan:!1}),Object(m.jsx)(M,{onSpeedChanged:function(e){var t=e.type,a=e.selected;"run"===t&&(n.current.isRunning=a,i(a?"run":null))},onMoveChanged:function(e){var t=e.type,a=e.direction,c=new Set(n.current.movements),r=c.size;n.current.walkClock.running||n.current.walkClock.start(),"end"===t?c.delete(a):"start"===t&&c.add(a),r!==c.size&&setTimeout((function(){n.current.walkClock.stop()}),100),n.current.movements=Object(g.a)(c.values())},onAttack:function(){if(n.current.comboResetTimer&&clearTimeout(n.current.comboResetTimer),n.current.comboResetTimer=setTimeout((function(){n.current.attack.combo=0}),1e3),!n.current.attack.isAttackInProgress){var e=n.current.attack.combo;switch(e){case 0:i("small-slash");break;case 1:i("kick");break;case 2:i("spin-slash")}n.current.attack.combo=e>=2?0:e+1,n.current.attack.isAttackInProgress=!0}}})]})}function D(e){var t=Object(v.a)("".concat(P,"/animations/").concat(e,".fbx"));return t.animations[0].name=e,t}function E(e){var t=Object(u.b)((function(){return Object(i.a)({mass:1,position:[.5,15,0]},e)})),n=Object(o.a)(t,1)[0];return Object(m.jsx)("mesh",{ref:n,children:Object(m.jsx)("boxBufferGeometry",{})})}var L=function(){return Object(m.jsxs)(a.Suspense,{fallback:null,children:[Object(m.jsxs)(d.a,{className:"main-canvas",mode:"concurrent",linear:!0,dpr:[1,1.5],camera:{position:[0,0,10],near:.01,far:1e4,fov:70},children:[Object(m.jsx)("ambientLight",{intensity:.5}),Object(m.jsx)("spotLight",{position:[10,55,10],angle:1}),Object(m.jsx)(l.a,{position:[0,0,0],width:100,height:20,far:20,rotation:[Math.PI/2,0,0]}),Object(m.jsxs)(u.a,{children:[Object(m.jsx)(E,{}),Object(m.jsx)(O,{}),Object(m.jsx)(f,{}),Object(m.jsx)(z,{})]})]}),Object(m.jsx)(b.a,{})]})};s.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(L,{})}),document.getElementById("root"))}},[[63,1,2]]]);
//# sourceMappingURL=main.d9ecbd0a.chunk.js.map