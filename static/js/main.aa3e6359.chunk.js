(this.webpackJsonpgame=this.webpackJsonpgame||[]).push([[0],{47:function(e,t,n){},70:function(e,t,n){"use strict";n.r(t);var c=n(5),a=n.n(c),r=n(39),i=n.n(r),s=(n(47),n(9)),o=n(7),l=n(23),u=n(75),d=n(78),b=n(13),j=n(76),m=n(10);function v(){return Object(m.jsx)(j.a,{distance:3e3,turbidity:8,rayleigh:6,mieCoefficient:.005,mieDirectionalG:.8,inclination:.49,azimuth:.25})}var f=n(71),h=n(74),O=Math.PI/2-.1,k="/game/assets";function p(){var e=Object(f.a)(["".concat(k,"/textures/ground-texture-skin.jpg"),"".concat(k,"/textures/ground-texture-color.jpg")]),t=Object(s.a)(e,2),n=t[0],c=t[1],a=Object(l.c)((function(){return{position:[0,-.01,0],rotation:[-Math.PI/2,0,0]}})),r=Object(s.a)(a,1)[0];return Object(m.jsx)(h.a,{resolution:512,ref:r,args:[100,100,4,4],mirror:.4,mixBlur:8,mixStrength:1,rotation:[-Math.PI/2,0,Math.PI/2],blur:[400,100],children:function(e,t){return Object(m.jsx)(e,Object(o.a)({color:"#797979",metalness:.4,roughnessMap:n,normalMap:c,normalScale:[1,1]},t))}})}var g=n(14),x=n(1),w=n(2),y=n(42),M={movement:new(function(){function e(){Object(x.a)(this,e),this.callbacks=new Map}return Object(w.a)(e,[{key:"addEventListener",value:function(e,t){this.callbacks.has(e)||this.callbacks.set(e,new Set);var n=this.callbacks.get(e);return n.has(t)||n.add(t),{remove:function(){n.delete(t)}}}},{key:"dispatchEvent",value:function(e,t){var n=this.callbacks.get(e);if(null===n||void 0===n?void 0:n.size)for(var c=0,a=Object(g.a)(n.values());c<a.length;c++){(0,a[c])(t)}}}]),e}())},C=Object(c.createContext)(M);function S(e){var t=e.show,n=e.children;return Object(m.jsxs)(C.Provider,{value:M,children:[t&&Object(m.jsx)("div",{className:"joystick",children:Object(m.jsx)(y.Joystick,{size:100,baseColor:"rgba(100, 100, 100, 0.5)",stickColor:"rgba(100, 100, 100, 0.8)",move:function(e){M.movement.dispatchEvent("move",e)},stop:function(e){M.movement.dispatchEvent("stop",e)}})}),n]})}function A(){return Object(c.useContext)(C)}var E=n(16),P=n(73),T=n(77),I=n(72),R=n(0),z=n(43),L=n(35),D=n.n(L),W={w:"forward",s:"backward",a:"left",d:"right"};function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onAttack,n=e.onMoveChanged,a=e.onSpeedChanged,r=A(),i=r.movement;Object(c.useEffect)((function(){var e=[];return e.push(i.addEventListener("move",(function(e){null===n||void 0===n||n({type:"start",cords:[e.x,e.y]})}))),e.push(i.addEventListener("stop",(function(e){null===n||void 0===n||n({type:"end"})}))),function(){e.forEach((function(e){return e.remove()}))}}),[i]);var s=function(e){switch(e.preventDefault(),e.key){case"w":case"a":case"s":case"d":null===n||void 0===n||n({type:"start",direction:W[e.key]});break;case"Shift":null===a||void 0===a||a({type:"run",selected:!0})}},o=function(e){switch(e.preventDefault(),e.key){case"w":case"a":case"s":case"d":null===n||void 0===n||n({type:"end",direction:W[e.key]});break;case"Shift":null===a||void 0===a||a({type:"run",selected:!1})}};function l(e){e.preventDefault(),t()}return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(D.a,{target:"window",onKeyDown:s,onKeyUp:o}),Object(m.jsx)(D.a,{target:document.querySelector(".main-canvas"),onClick:l})]})}var F=["idle","walk","run"],N=["small-slash","kick","spin-slash"];function J(e){Object.assign({},e);var t=Object(c.useRef)(),n=Object(c.useRef)({walkClock:new R.Clock,comboResetTimer:null,movements:[],isRunning:!1,isWalking:!1,attack:{combo:0,isAttackInProgress:!1},cordsToMove:null}),a=Object(c.useState)(),r=Object(s.a)(a,2),i=r[0],o=r[1],l=Object(P.a)("".concat(k,"/models/player.fbx")),u=function(e){var t=G("idle"),n=G("kick"),c=G("small-slash"),a=G("spin-slash"),r=G("walk"),i=G("run");return Object(I.a)([].concat(Object(g.a)(i.animations),Object(g.a)(t.animations),Object(g.a)(n.animations),Object(g.a)(c.animations),Object(g.a)(a.animations),Object(g.a)(r.animations)),e)}(l),d=u.actions,j=u.mixer;return Object(c.useEffect)((function(){l.scale.x>.02&&l.scale.multiplyScalar(.02),t.current.rotateSpeed=.3}),[]),Object(c.useEffect)((function(){var e=i||"idle",t=d[e];return j.addEventListener("finished",(function(e){N.some((function(t){return d[t]===e.action}))&&o("idle")})),null===t||void 0===t||t.reset().fadeIn(F.includes(e)?.5:.1).setLoop(F.includes(e)?R.LoopRepeat:R.LoopOnce).setEffectiveTimeScale(N.includes(e)?1.4:1).play(),t.clampWhenFinished=!0,function(){null===t||void 0===t||t.fadeOut(.5)}}),[i,d,j]),Object(b.c)((function(){var e,c;t.current.target=l.position.clone().setY(2.5),n.current.isWalking&&!n.current.attack.isAttackInProgress?o(n.current.isRunning?"run":"walk"):n.current.isWalking||n.current.attack.isAttackInProgress||o("idle");var a=new R.Vector3,r=Object(z.a)(0,n.current.isRunning?.15:.08,Math.min(n.current.walkClock.getElapsedTime(),1));if(!n.current.attack.isAttackInProgress)if(n.current.cordsToMove){var u=Object(s.a)(n.current.cordsToMove,2),b=u[0],j=u[1];a.x=b/100*r,a.z=-j/100*r}else{var m,v=Object(E.a)(n.current.movements);try{for(v.s();!(m=v.n()).done;){switch(m.value){case"backward":a.z+=r;break;case"forward":a.z+=-r;break;case"right":a.x+=.02;break;case"left":a.x+=-.02}}}catch(O){v.e(O)}finally{v.f()}}a.applyAxisAngle(new R.Vector3(0,1,0),t.current.getAzimuthalAngle()),l.rotation.y=t.current.getAzimuthalAngle()+Math.PI,l.position.add(a);var f=null===(e=d[i])||void 0===e?void 0:e.time,h=null===(c=d[i])||void 0===c?void 0:c.getClip().duration;(!i||F.includes(i)||f>h-.01*h)&&(n.current.attack.isAttackInProgress=!1)})),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("primitive",{object:l,dispose:null}),Object(m.jsx)(T.a,{ref:t,maxPolarAngle:O,maxDistance:5,enableDamping:!1,enablePan:!1}),Object(m.jsx)(B,{onSpeedChanged:function(e){var t=e.type,c=e.selected;"run"===t&&n.current.isWalking&&(n.current.isRunning=c,o(c?"run":null))},onMoveChanged:function(e){var t=e.type,c=e.direction,a=e.cords,r=new Set(n.current.movements),i=r.size;n.current.walkClock.running||n.current.walkClock.start(),"end"===t?r.delete(c):"start"===t&&r.add(c),i!==r.size&&setTimeout((function(){n.current.walkClock.stop()}),100),n.current.movements=Object(g.a)(r.values()),n.current.cordsToMove=a,n.current.isWalking=Boolean(n.current.movements.length||n.current.cordsToMove)},onAttack:function(){if(n.current.comboResetTimer&&clearTimeout(n.current.comboResetTimer),n.current.comboResetTimer=setTimeout((function(){n.current.attack.combo=0}),1e3),!n.current.attack.isAttackInProgress){var e=n.current.attack.combo;switch(e){case 0:o("small-slash");break;case 1:o("kick");break;case 2:o("spin-slash")}n.current.attack.combo=e>=2?0:e+1,n.current.attack.isAttackInProgress=!0}}})]})}function G(e){var t=Object(P.a)("".concat(k,"/models/animations/").concat(e,".fbx"));return t.animations[0].name=e,t}function K(e){var t=Object(l.b)((function(){return Object(o.a)({mass:1,position:[.5,15,0]},e)})),n=Object(s.a)(t,1)[0];return Object(m.jsx)("mesh",{ref:n,children:Object(m.jsx)("boxBufferGeometry",{})})}function V(e){var t=e.showScreenControllers;return Object(m.jsx)(S,{show:t,children:Object(m.jsxs)(c.Suspense,{fallback:null,children:[Object(m.jsxs)(b.a,{className:"main-canvas",mode:"concurrent",linear:!0,dpr:[1,1.5],camera:{position:[0,0,10],near:.01,far:1e4,fov:70},children:[Object(m.jsx)("ambientLight",{intensity:.5}),Object(m.jsx)("spotLight",{position:[10,55,10],angle:1}),Object(m.jsx)(u.a,{position:[0,0,0],width:100,height:20,far:20,rotation:[Math.PI/2,0,0]}),Object(m.jsxs)(l.a,{children:[Object(m.jsx)(K,{}),Object(m.jsx)(p,{}),Object(m.jsx)(v,{}),Object(m.jsx)(J,{})]})]}),Object(m.jsx)(d.a,{})]})})}var q=n(37),U=n(36);var Y=function(){var e=Object(c.useState)(H()),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(q.b)();return Object(c.useEffect)((function(){window.matchMedia("(orientation: landscape)").addEventListener("change",(function(){a(H())}))}),[]),n?Object(m.jsx)("div",{className:"game-container",children:navigator.userAgent.match(new RegExp("iphone","gi"))?Object(m.jsx)(V,{showScreenControllers:U.isMobile}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{onClick:r.enter,children:"Click to start"}),Object(m.jsx)("div",{style:{display:r.active?"block":"none"},children:Object(m.jsx)(q.a,{handle:r,children:Object(m.jsx)(V,{showScreenControllers:U.isMobile})})})]})}):Object(m.jsx)("span",{className:"orientation-container",children:"Make it landscape; ROTATE!"})};function H(){return window.matchMedia("(orientation: landscape)").matches}i.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(Y,{})}),document.getElementById("root"))}},[[70,1,2]]]);
//# sourceMappingURL=main.aa3e6359.chunk.js.map